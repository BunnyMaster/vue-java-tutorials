## APT

### 安装

这是Ubuntu官方推荐的方式，自动处理依赖关系，易于升级和卸载。适用于大多数软件安装：

```bash
# 安装
sudo apt install <包名>

# 升级
sudo apt update
sudo apt upgrade

# 删除
sudo apt remove <包名>
```

### 卸载

```bash
# 1. 标准卸载（保留配置文件）
sudo apt remove <包名>

# 2. 彻底卸载（删除配置文件）
sudo apt purge <包名>

# 3. 删除不再需要的依赖包
sudo apt autoremove

# 4. 检查是否有残留配置
sudo apt autoremove --purge
```

#### 进阶清理

```bash
# 查看软件包安装的所有文件
dpkg -L <包名>

# 查找相关配置文件
find /etc -name "*<包名>*"
find ~/ -name "*<包名>*"

# 清理APT缓存
sudo apt clean          # 删除所有缓存
sudo apt autoclean      # 只删除旧版本缓存
```

## DEB包安装

### 安装

```bash
# 安装
sudo dpkg -i <包名>.deb

# 修复依赖
sudo apt install -f
```

### 卸载

```bash
# 1. 使用dpkg卸载
sudo dpkg -r <包名>      # 卸载但保留配置
sudo dpkg -P <包名>      # 彻底卸载

# 2. 如果dpkg卸载失败，先用apt修复
sudo apt remove <包名>
```

## TAR包安装

### 安装

```bash
# 解压
tar -xzf <包名>.tar.gz

# 进入目录
cd <解压后的目录>

# 配置
./configure

# 编译
make

# 安装
sudo make install
```

### 卸载

```bash
# 1. 卸载软件
sudo snap remove <包名>

# 2. 查看和删除旧版本（自动）
sudo snap remove <包名> --purge

# 3. 查看snap安装的所有包
snap list

# 4. 清理snap缓存（谨慎使用）
sudo rm -rf /var/lib/snapd/cache/*
```

## Appimage

```bash
# 安装AppImageLauncher
sudo add-apt-repository ppa:appimagelauncher-team/stable
sudo apt update
sudo apt install appimagelauncher

# 安装后，双击AppImage文件会自动集成到系统
```

## Snap包

Ubuntu App Center 默认提供了这些软件，如需使用可在其中直接下载。不过目前部分应用仍存在一些问题，例如 Obsidian：若从 App Center 安装，可能会出现无法输入中文的情况^[2025-12-16 ]。建议改用 Deb 包或 AppImage 版本来解决。期待后续版本能够修复这一问题。

**优点**：跨发行版、自动更新、沙盒安全。
**缺点**：启动较慢，占用磁盘空间较多。

```bash
sudo snap install <包名>
```

## Flatpak

**优点**：跨发行版、沙盒安全。
**缺点**：类似Snap，占用空间较大。

```bash
# 安装命令
flatpak install <包名>

# 需先安装Flatpak
sudo apt install flatpak
```

## 安装包清理

### 定期清理

```bash
sudo apt autoremove --purge
sudo apt clean
flatpak uninstall --unused

# 删除过时的包缓存
sudo apt autoclean   

# 删除所有包缓存（慎用）
sudo apt clean      

# 移除自动安装且不再需要的依赖
sudo apt autoremove 

# 注意：可能清除部分应用状态
rm -rf ~/.cache/*    
```

#### 其他工具

```bash
# 保留7天内日志
sudo journalctl --vacuum-time=7d  

# 图形化清理工具
sudo apt install stacer bleachbit  
```

### 清理脚本

```bash
#!/bin/bash
# clean_package.sh

PACKAGE="$1"

echo "=== 清理包: $PACKAGE ==="

# 1. 尝试用apt卸载
sudo apt purge $PACKAGE 2>/dev/null

# 2. 查找残留
echo "=== 查找配置文件 ==="
find /etc -name "*$PACKAGE*" 2>/dev/null
find ~/ -name "*$PACKAGE*" 2>/dev/null

# 3. 询问是否删除
read -p "是否删除以上找到的文件？(y/N): " confirm
if [[ $confirm == "y" ]]; then
    sudo find /etc -name "*$PACKAGE*" -delete 2>/dev/null
    find ~/ -name "*$PACKAGE*" -delete 2>/dev/null
fi

echo "=== 清理完成 ==="
```

### 专业排查工具

#### 1. 使用 `deborphan` 查找孤立包

```bash
sudo apt install deborphan
deborphan    # 列出不再需要的库包
```

#### 2. 使用 `aptitude` 分析依赖

```bash
sudo aptitude remove <包名>
# 会显示详细的依赖关系
```

#### 3. 检查服务残留

```bash
# 查看是否有相关服务
systemctl list-units --all | grep <包名>

# 停止并禁用服务
sudo systemctl stop <服务名>
sudo systemctl disable <服务名>

# 删除服务文件
sudo rm /etc/systemd/system/<服务名>.service
```

#### 4. 使用 `lsof` 查看文件使用情况

```bash
# 查看哪些进程在使用某个目录/文件
sudo lsof /usr/local/<包名目录>/
```

