## 设置网络

### 示例文件

```yaml
network:
  ethernets:
    eth0:
      dhcp4: false
      addresses: [172.20.116.203/20]
      optional: true
      routes:
        - to: default
          via: 172.20.112.1
      nameservers:
        addresses: [8.8.8.8]
  version: 2
```

### 应用配置

```bash
sudo netplan apply
sudo reboot
```

## 设置静态IP地址

### 打开配置文件

```sh
# 文件路径
sudo vim /etc/netplan/你的文件.yaml

# 示例
sudo vim /etc/netplan/00-installer-config.yaml
```

### 编辑配置文件

#### 源文件示例

```sh
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        eth0:
            dhcp4: true
    version: 2
```

#### 示例文件

```sh
network:
  ethernets:
    eth0:
      dhcp4: false
      addresses: [172.20.116.203/20]
      optional: true
      routes:
        - to: default
          via: 172.20.112.1
      nameservers:
        addresses: [8.8.8.8]
  version: 2
```

### 应用配置文件

```sh
sudo netplan apply
sudo reboot
```

## 防火墙

### 防火墙状态

####  检查防火墙状态

```bash
# 查看 UFW 状态
sudo ufw status

# 详细状态（含规则）
sudo ufw status verbose

# 查看编号的规则
sudo ufw status numbered

# 检查是否启用
sudo ufw status | grep Status
```

#### 开启/关闭防火墙

```bash
# 启用防火墙（默认拒绝所有入站，允许所有出站）
sudo ufw enable

# 禁用防火墙
sudo ufw disable

# 重启防火墙
sudo ufw reload

# 重置防火墙（删除所有规则）
sudo ufw reset
```

#### 默认策略设置

```bash
# 设置默认策略
sudo ufw default deny incoming   # 默认拒绝所有入站
sudo ufw default allow outgoing  # 默认允许所有出站

# 查看默认策略
sudo ufw show raw | grep default
```

### 规则管理

#### 允许/拒绝特定端口

```bash
# 允许端口
sudo ufw allow 80          # HTTP
sudo ufw allow 443         # HTTPS
sudo ufw allow 22          # SSH
sudo ufw allow 8080/tcp    # 指定 TCP
sudo ufw allow 53/udp      # 指定 UDP

# 拒绝端口
sudo ufw deny 23           # Telnet
sudo ufw deny 3306         # MySQL
sudo ufw deny 25/tcp       # SMTP TCP

# 端口范围
sudo ufw allow 8000:9000/tcp    # TCP 范围
sudo ufw allow 8000:9000/udp    # UDP 范围
```

#### 允许/拒绝特定 IP

```bash
# 允许特定 IP 访问所有端口
sudo ufw allow from 192.168.1.100

# 允许 IP 访问特定端口
sudo ufw allow from 192.168.1.100 to any port 22
sudo ufw allow from 192.168.1.0/24 to any port 80

# 拒绝 IP
sudo ufw deny from 203.0.113.10
sudo ufw deny from 203.0.113.0/24

# 允许特定 IP 范围访问特定端口
sudo ufw allow from 192.168.1.0/24 to any port 3306
```

#### 基于服务的规则

```bash
# 使用服务名（在 /etc/services 中定义）
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
sudo ufw allow 'Nginx Full'  # Nginx 预定义规则
sudo ufw allow 'Apache'
sudo ufw allow 'PostgreSQL'
```

#### 指定网络接口

```bash
# 允许特定接口
sudo ufw allow in on eth0 to any port 80
sudo ufw allow in on eth1 from 192.168.1.0/24

# 拒绝特定接口
sudo ufw deny in on eth0 to any port 23
```

## 设置镜像源
### 备份镜像源
```bash
sudo cp /etc/apt/sources.list /etc/apt/sources.list.back
```

### 编辑镜像源
```bash
sudo vim /etc/apt/sources.list
```

#### 镜像源配置

```shell
deb https://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse

# deb https://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse
# deb-src https://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse
```

### 更新软件包列表
```bash
# 首先更新软件包列表
sudo apt update

# 升级已安装的软件包
sudo apt upgrade

# 如果需要完整升级
sudo apt full-upgrade
```

## 代理配置

### 检查当前的网络代理配置

```bash
env | grep -i proxy
```

### 清除不同级别的代理设置

系统代理设置通常存储在几个配置文件中。请用文本编辑器（如 `nano`）打开并检查以下文件，**删除**包含 `proxy` 或 `PROXY` 的行。

| 配置文件路径       | 说明                                                      |
| :----------------- | :-------------------------------------------------------- |
| `~/.bashrc`        | 当前用户的shell配置文件。                                 |
| `~/.profile`       | 当前用户的配置文件（如果使用`.bashrc`无效时可检查此处）。 |
| `/etc/environment` | 系统全局环境配置文件。                                    |

**操作示例**：

```bash
sudo nano /etc/environment
```

在打开的文档中找到并删除类似 `http_proxy="http://..."` 的行，保存退出。为使更改生效，请**重启系统**或**重新登录用户**。

### 清理DNS缓存

DNS缓存可能记录了过期的域名解析信息，可以尝试清空。

* **主流方法（使用systemd-resolved）**：

  ```bash
  sudo systemd-resolve --flush-caches
  ```

* **备用方法**：

  *   重启网络管理器：`sudo systemctl restart NetworkManager`。
  *   如果安装了`nscd`服务，可重启它：`sudo systemctl restart nscd`。

