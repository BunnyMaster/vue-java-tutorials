## 防火墙状态

###  检查防火墙状态

```bash
# 查看 UFW 状态
sudo ufw status

# 详细状态（含规则）
sudo ufw status verbose

# 查看编号的规则
sudo ufw status numbered

# 检查是否启用
sudo ufw status | grep Status
```

### 开启/关闭防火墙

```bash
# 启用防火墙（默认拒绝所有入站，允许所有出站）
sudo ufw enable

# 禁用防火墙
sudo ufw disable

# 重启防火墙
sudo ufw reload

# 重置防火墙（删除所有规则）
sudo ufw reset
```

### 默认策略设置

```bash
# 设置默认策略
sudo ufw default deny incoming   # 默认拒绝所有入站
sudo ufw default allow outgoing  # 默认允许所有出站

# 查看默认策略
sudo ufw show raw | grep default
```

## 规则管理

### 允许/拒绝特定端口

```bash
# 允许端口
sudo ufw allow 80          # HTTP
sudo ufw allow 443         # HTTPS
sudo ufw allow 22          # SSH
sudo ufw allow 8080/tcp    # 指定 TCP
sudo ufw allow 53/udp      # 指定 UDP

# 拒绝端口
sudo ufw deny 23           # Telnet
sudo ufw deny 3306         # MySQL
sudo ufw deny 25/tcp       # SMTP TCP

# 端口范围
sudo ufw allow 8000:9000/tcp    # TCP 范围
sudo ufw allow 8000:9000/udp    # UDP 范围
```

### 允许/拒绝特定 IP

```bash
# 允许特定 IP 访问所有端口
sudo ufw allow from 192.168.1.100

# 允许 IP 访问特定端口
sudo ufw allow from 192.168.1.100 to any port 22
sudo ufw allow from 192.168.1.0/24 to any port 80

# 拒绝 IP
sudo ufw deny from 203.0.113.10
sudo ufw deny from 203.0.113.0/24

# 允许特定 IP 范围访问特定端口
sudo ufw allow from 192.168.1.0/24 to any port 3306
```

### 基于服务的规则

```bash
# 使用服务名（在 /etc/services 中定义）
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
sudo ufw allow 'Nginx Full'  # Nginx 预定义规则
sudo ufw allow 'Apache'
sudo ufw allow 'PostgreSQL'
```

### 指定网络接口

```bash
# 允许特定接口
sudo ufw allow in on eth0 to any port 80
sudo ufw allow in on eth1 from 192.168.1.0/24

# 拒绝特定接口
sudo ufw deny in on eth0 to any port 23
```
