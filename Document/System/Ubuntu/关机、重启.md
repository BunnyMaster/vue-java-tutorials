## 关机相关

###  **`shutdown` 命令**（最常用）

```bash
# 立即关机
sudo shutdown -h now
sudo shutdown now

# 在指定时间后关机（10分钟后）
sudo shutdown -h +10

# 在特定时间关机（23:00）
sudo shutdown -h 23:00
```

###  `halt` 命令

```bash
# 立即停止系统
sudo halt
```

###  `poweroff` 命令

```bash
# 直接关闭电源
sudo poweroff
```

### `init` 命令

```bash
# 切换到运行级别0（关机）
sudo init 0
```

#### `init`所有含义

```bash
# 切换到不同运行级别
sudo init 0      # 关机
sudo init 1      # 单用户模式（救援模式）
sudo init 2      # 多用户模式（无网络）
sudo init 3      # 多用户模式（命令行）
sudo init 4      # 保留/自定义
sudo init 5      # 多用户模式（图形界面）
sudo init 6      # 重启
sudo init s      # 单用户模式（同 1）
sudo init S      # 单用户模式
```

| 运行级别       | 名称                    | 用途                               |
| :------------- | :---------------------- | :--------------------------------- |
| **0**          | Halt                    | 关机                               |
| **1**          | Single-user mode        | 救援/维护模式                      |
| **2**          | Multi-user, without NFS | 多用户无网络（Debian/Ubuntu 同 3） |
| **3**          | Full multi-user mode    | 完整多用户（文本模式）             |
| **4**          | Unused                  | 保留/自定义                        |
| **5**          | X11                     | 图形界面模式                       |
| **6**          | Reboot                  | 重启                               |
| **S** 或 **s** | Single-user             | 单用户模式                         |

## 重启命令

### `reboot`命令

```bash
# 立即重启
sudo reboot
```

###  `shutdown` 命令重启选项

```bash
# 立即重启
sudo shutdown -r now
sudo shutdown -r 0

# 10分钟后重启
sudo shutdown -r +10

# 在特定时间重启（14:30）
sudo shutdown -r 14:30
```

###  `init` 命令

```bash
# 切换到运行级别6（重启）
sudo init 6
```

###  **`systemctl` 命令**（systemd系统）

```bash
# 重启
sudo systemctl reboot

# 关机
sudo systemctl poweroff

# 停止系统（不切断电源）
sudo systemctl halt

# 休眠
sudo systemctl suspend

# 休眠到磁盘
sudo systemctl hibernate
```

## 延迟和取消操作

### 延迟执行

```bash
# 30分钟后关机
sudo shutdown -h +30 "系统将在30分钟后关机进行维护"

# 明天凌晨2点重启
sudo shutdown -r 2:00
```

### 取消计划中的关/重启

```bash
sudo shutdown -c
```

## 特殊选项

### 强制操作

```bash
# 强制立即重启（跳过正常关闭流程）
sudo reboot -f

# 强制关机
sudo poweroff -f
```

### 不发送警告消息

```bash
# 安静模式关机
sudo shutdown -h now --no-wall
```

## 附录

### 为何有多种命令

#### 历史演变和兼容性

| 命令              | 时代      | 设计目的                         |
| :---------------- | :-------- | :------------------------------- |
| `init`            | 1970s     | Unix SysV init 系统的一部分      |
| `shutdown`        | 1980s     | 更安全的关机方式，支持延迟和通知 |
| `halt`/`poweroff` | 早期 Unix | 直接停止系统/切断电源            |
| `reboot`          | 早期 Unix | 专门的重启命令                   |
| `systemctl`       | 2010s     | Systemd 的统一管理命令           |

#### 技术层面的区别

1. **`init`**：切换运行级别，可能触发复杂的关机脚本
2. **`shutdown`**：更"礼貌"，会通知用户、停止服务、卸载文件系统
3. **`halt`/`poweroff`**：更"粗暴"，可能跳过某些清理步骤
4. **`systemctl`**：现代标准，整合所有功能

### 最佳实践——`Systemd`

```bash
# 1. 可以延迟执行（给用户保存时间）
sudo shutdown -h +10 "系统将在10分钟后关机进行维护"

# 2. 可以广播通知所有用户
sudo shutdown -h +5 "紧急维护！请立即保存工作！"

# 3. 可以取消计划中的关机
sudo shutdown -c

# 4. 可以在特定时间关机
sudo shutdown -h 23:00

# 5. 完整的关机流程：
#    - 发送警告给所有登录用户
#    - 阻止新用户登录
#    - 执行所有关机脚本
#    - 正常停止服务
#    - 卸载文件系统
#    - 最后切断电源
```

