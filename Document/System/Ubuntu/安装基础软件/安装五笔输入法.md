## 安装五笔输入法

>[!NOTE]
>文档参考：https://muzing.top/posts/3fc249cf/

### 基础包

1. Fcitx 5 主程序
2. 中文输入法引擎
3. 图形界面相关

```bash
sudo apt install fcitx5 \
fcitx5-chinese-addons \
fcitx5-frontend-gtk4 fcitx5-frontend-gtk3 fcitx5-frontend-gtk2 \
fcitx5-frontend-qt5
```

### 安装中文词库

```bash
# 下载词库文件
wget https://github.com/felixonmars/fcitx5-pinyin-zhwiki/releases/download/0.2.4/zhwiki-20220416.dict
# 创建存储目录
mkdir -p ~/.local/share/fcitx5/pinyin/dictionaries/
# 移动词库文件至该目录
mv zhwiki-20220416.dict ~/.local/share/fcitx5/pinyin/dictionaries/
```

### 设置为默认输入法

根据弹出窗口的提示，将首选输入法设置为 Fcitx 5 即可。

```bash
im-config
```

## 解决部分不能输入

### 1、配置文件

可能是有些内容没有开启，在终端中输入下面内容或者手动打开

```bash
sudo vim /etc/environment
```

**加入以下内容**

```properties
GTK_IM_MODULE=fcitx
QT_IM_MODULE=fcitx
XMODIFIERS=@im=fcitx
```

**让其生效**

- 重启系统是最直接的方式。
- 或注销后重新登录。

### 2、配置与运行状态

**检查 Fcitx5 是否正在运行**

```bash
# 如果返回 0，说明已运行；如果返回非零值，需要手动启动：
fcitx5-remote
```

如果没有运行手动启动方式

```bash
fcitx5 -d
```

**查看输入法模块是否正确加载**

> [!NOTE]
>
> 如果在里面有报错好好看看是缺少什么包

```bash
fcitx5-diagnose
```

### 3、检查并修复 Qt 应用输入支持

```bash
apt list --installed | grep fcitx5
```

确保以下包存在：

```properties
fcitx5-frontend-qt5
fcitx5-frontend-qt6
```

如果没有安装这些

```bash
sudo apt update
sudo apt install fcitx5-frontend-qt5 fcitx5-frontend-qt6
```

**创建或检查 Qt 插件的符号链接（关键步骤）：**

```bash
# 检查 Qt5 插件目录
ls -l ~/.local/share/qt5/plugins/platforminputcontexts/
ls -l /usr/lib/x86_64-linux-gnu/qt5/plugins/platforminputcontexts/

# 检查 Qt6 插件目录
ls -l ~/.local/share/qt6/plugins/platforminputcontexts/
ls -l /usr/lib/x86_64-linux-gnu/qt6/plugins/platforminputcontexts/
```

确保这些目录中存在 `libfcitx5platforminputcontextplugin.so` 文件。如果没有，创建符号链接：

```bash
# Qt5
sudo ln -s /usr/lib/x86_64-linux-gnu/qt5/plugins/platforminputcontexts/libfcitx5platforminputcontextplugin.so ~/.local/share/qt5/plugins/platforminputcontexts/ 2>/dev/null || true

# Qt6
sudo ln -s /usr/lib/x86_64-linux-gnu/qt6/plugins/platforminputcontexts/libfcitx5platforminputcontextplugin.so ~/.local/share/qt6/plugins/platforminputcontexts/ 2>/dev/null || true
```

### FAQ - 缺失GTK

#### 第一步：安装缺失的 GTK 输入法模块

```bash
# 安装 Fcitx5 的 GTK 支持模块
sudo apt install fcitx5-frontend-gtk2 fcitx5-frontend-gtk3 fcitx5-frontend-gtk4

# 更新 GTK 输入法模块缓存
sudo gtk-query-immodules-2.0 --update-cache
sudo gtk-query-immodules-3.0 --update-cache

# 如果上述命令不存在，尝试替代命令
sudo update-gtk-immodules
```

#### 第二步：验证 GTK 模块是否安装成功

```bash
# 检查安装的包
apt list --installed | grep fcitx5-frontend-gtk

# 检查 GTK 模块缓存是否包含 fcitx5
grep fcitx5 /lib/x86_64-linux-gnu/gtk-2.0/2.10.0/immodules.cache
grep fcitx5 /lib/x86_64-linux-gnu/gtk-3.0/3.0.0/immodules.cache
```

最后重启下
